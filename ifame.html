<!--<!DOCTYPE html>-->
<!--<html>-->
<!--<head>-->
<!--  <title>Truy cập Webcam và Chụp ảnh</title>-->
<!--  <style>-->
<!--	html, body {-->
<!--		margin: 0;-->
<!--	}-->
<!--  -->
<!--    #videoElement {-->
<!--      width: 100vw;-->
<!--      height: 100vh;-->
<!--    }-->
<!--  </style>-->
<!--</head>-->
<!--<body>-->
<!--  <video id="videoElement" autoplay></video>-->
<!--  <button id="captureButton">Chụp ảnh</button>-->
<!--  <img id="capturedImage">-->

<!--  <script>-->
<!--    var video = document.getElementById("videoElement");-->
<!--    var captureButton = document.getElementById("captureButton");-->
<!--    var capturedImage = document.getElementById("capturedImage");-->
<!--    var canvas = document.createElement("canvas");-->
<!--    var canvasContext = canvas.getContext("2d");-->

<!--    // Kiểm tra xem trình duyệt đã hỗ trợ API getUserMedia chưa-->
<!--    if (navigator.mediaDevices.getUserMedia) {-->
<!--      // Yêu cầu truy cập vào video từ webcam-->
<!--      navigator.mediaDevices.getUserMedia({ video: true })-->
<!--        .then(function(stream) {-->
<!--          // Gán stream vào video element để hiển thị hình ảnh từ webcam-->
<!--          video.srcObject = stream;-->
<!--        })-->
<!--        .catch(function(error) {-->
<!--          console.log("Có lỗi xảy ra: " + error);-->
<!--        });-->

<!--      // Xử lý sự kiện click của nút chụp ảnh-->
<!--      captureButton.addEventListener("click", function() {-->
<!--        // Thiết lập kích thước của canvas bằng với video element-->
<!--        canvas.width = video.videoWidth;-->
<!--        canvas.height = video.videoHeight;-->

<!--        // Vẽ hình ảnh từ video element lên canvas-->
<!--        canvasContext.drawImage(video, 0, 0, canvas.width, canvas.height);-->

<!--        // Lấy dữ liệu ảnh từ canvas dưới dạng URL-->
<!--        var imageDataURL = canvas.toDataURL("image/png");-->

<!--        // Gán dữ liệu ảnh đã chụp vào thẻ <img> để hiển thị-->
<!--        capturedImage.src = imageDataURL;-->
<!--      });-->
<!--    }-->
<!--  </script>-->
<!--</body>-->
<!--</html>-->

<!-- code run được trên ios -->
<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--    <title>Truy cập Webcam và Chụp ảnh trên Safari</title>-->
<!--    <meta charset="utf-8">-->
<!--    <meta name="description" content="WebRTC code samples">-->
<!--    <meta name="viewport" content="width=device-width, user-scalable=yes, initial-scale=1, maximum-scale=1">-->
<!--    <meta itemprop="description" content="Client-side WebRTC code samples">-->
<!--    <meta itemprop="image" content="../../../images/webrtc-icon-192x192.png">-->
<!--    <meta itemprop="name" content="WebRTC code samples">-->
<!--    <meta name="mobile-web-app-capable" content="yes">-->
<!--    <meta id="theme-color" name="theme-color" content="#ffffff">-->

<!--    <style>-->
<!--        #videoElement {-->
<!--            width: 100%;-->
<!--            height: auto;-->
<!--            object-fit: cover; /* Thêm thuộc tính này để hiển thị video theo tỷ lệ */-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--<video width="320" height="240" id="videoElement" autoplay muted playsinline></video>-->
<!--<button id="captureButton">Chụp ảnh</button>-->
<!--<button id="showVideo">show video</button>-->
<!--<img id="capturedImage" alt="">-->
<!--<script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>-->
<!--<script>-->
<!--    console.log('hello')-->
<!--    var video = document.getElementById("videoElement");-->
<!--    var captureButton = document.getElementById("captureButton");-->
<!--    var capturedImage = document.getElementById("capturedImage");-->
<!--    var canvas = document.createElement("canvas");-->
<!--    var canvasContext = canvas.getContext("2d");-->

<!--    // Put variables in global scope to make them available to the browser console.-->
<!--    const constraints = window.constraints = {-->
<!--        audio: false,-->
<!--        video: true,-->
<!--    };-->

<!--    function handleSuccess(stream) {-->
<!--        const video = document.querySelector('video');-->
<!--        const videoTracks = stream.getVideoTracks();-->
<!--        console.log('Got stream with constraints:', constraints);-->
<!--        console.log(`Using video device: ${videoTracks[0].label}`);-->
<!--        window.stream = stream; // make variable available to browser console-->
<!--        video.srcObject = stream;-->
<!--    }-->

<!--    function handleError(error) {-->
<!--        if (error.name === 'OverconstrainedError') {-->
<!--            const v = constraints.video;-->
<!--            errorMsg(`The resolution ${v.width.exact}x${v.height.exact} px is not supported by your device.`);-->
<!--        } else if (error.name === 'NotAllowedError') {-->
<!--            errorMsg('Permissions have not been granted to use your camera and ' +-->
<!--                'microphone, you need to allow the page access to your devices in ' +-->
<!--                'order for the demo to work.');-->
<!--        }-->
<!--        errorMsg(`getUserMedia error: ${error.name}`, error);-->
<!--    }-->

<!--    function errorMsg(msg, error) {-->
<!--        const errorElement = document.querySelector('#errorMsg');-->
<!--        errorElement.innerHTML += `<p>${msg}</p>`;-->
<!--        if (typeof error !== 'undefined') {-->
<!--            console.error(error);-->
<!--        }-->
<!--    }-->

<!--    async function init(e) {-->
<!--        try {-->
<!--            const stream = await navigator.mediaDevices.getUserMedia(constraints);-->
<!--            handleSuccess(stream);-->
<!--            e.target.disabled = true;-->
<!--        } catch (e) {-->
<!--            handleError(e);-->
<!--        }-->
<!--    }-->

<!--    document.querySelector('#showVideo').addEventListener('click', e => init(e));-->


<!--    // // Kiểm tra xem trình duyệt đã hỗ trợ API getUserMedia chưa-->
<!--    // if (navigator.mediaDevices.getUserMedia) {-->
<!--    //     // Yêu cầu truy cập vào video từ webcam-->
<!--    //     navigator.mediaDevices.getUserMedia({ video: true })-->
<!--    //         .then(function(stream) {-->
<!--    //             // Gán stream vào video element để hiển thị hình ảnh từ webcam-->
<!--    //             video.src = stream;-->
<!--    //             video.play(); // Thêm dòng này để đảm bảo video được phát khi truy cập trên Safari-->
<!--    //         })-->
<!--    //         .catch(function(error) {-->
<!--    //             console.log("Có lỗi xảy ra: " + error);-->
<!--    //         });-->
<!--    //-->
<!--        // Xử lý sự kiện click của nút chụp ảnh-->
<!--        captureButton.addEventListener("click", function() {-->
<!--            // Thiết lập kích thước của canvas bằng với video element-->
<!--            canvas.width = video.videoWidth;-->
<!--            canvas.height = video.videoHeight;-->

<!--            // Vẽ hình ảnh từ video element lên canvas-->
<!--            canvasContext.drawImage(video, 0, 0, canvas.width, canvas.height);-->

<!--            // Lấy dữ liệu ảnh từ canvas dưới dạng URL-->
<!--            var imageDataURL = canvas.toDataURL("image/png");-->

<!--            // Gán dữ liệu ảnh đã chụp vào thẻ <img> để hiển thị-->
<!--            capturedImage.src = imageDataURL;-->
<!--        });-->
<!--    // }-->
<!--</script>-->
<!--</body>-->
<!--</html>-->

code android 3
<!DOCTYPE html>
<html lang="en">
<head>
    <title>Truy cập Webcam và Chụp ảnh trên Safari</title>
    <meta charset="utf-8">
    <meta name="description" content="WebRTC code samples">
    <meta name="viewport" content="width=device-width, user-scalable=yes, initial-scale=1, maximum-scale=1">
    <meta itemprop="description" content="Client-side WebRTC code samples">
    <meta itemprop="image" content="../../../images/webrtc-icon-192x192.png">
    <meta itemprop="name" content="WebRTC code samples">
    <meta name="mobile-web-app-capable" content="yes">
    <meta id="theme-color" name="theme-color" content="#ffffff">

    <style>
        #videoElement {
            width: 100%;
            height: auto;
            object-fit: cover; /* Thêm thuộc tính này để hiển thị video theo tỷ lệ */
        }
    </style>
</head>
<body>
<video width="320" height="240" id="videoElement" autoplay muted playsinline></video>
<button id="captureButton">Chụp ảnh</button>
<button id="showVideo">Show video</button>
<button onclick="openLineCamera()">Mở Camera Action của Line</button>
<!--<button id="grantPermissionButton">grantPermissionButton</button>-->
<img id="capturedImage" alt="">
<canvas></canvas>
<div id="errorMsg"></div>

<script src="https://webrtc.github.io/adapter/adapter-1.0.2.js"></script>
<script>
    function openLineCamera() {
        if (typeof Line !== 'undefined' && Line !== null && typeof Line.Camera !== 'undefined' && Line.Camera !== null) {
            errorMsg("LineCamera khả dụng");
            Line.Camera.capture(
                function(result) {
                    // Xử lý kết quả từ Camera Action của Line
                    errorMsg(result);
                },
                function(error) {
                    // Xử lý lỗi từ Camera Action của Line
                    errorMsg(error);
                }
            );
        } else {
            // Xử lý khi LineCamera không khả dụng
            errorMsg("LineCamera không khả dụng");
        }
    }


    var video = document.getElementById("videoElement");
    var captureButton = document.getElementById("captureButton");
    var capturedImage = document.getElementById("capturedImage");
    var canvas = document.createElement("canvas");
    var canvasContext = canvas.getContext("2d");

    const constraints = {
        audio: false,
        video: {facingMode: 'environment'} // Thêm cấu hình này để chọn camera sau (back camera) trên Android
    };

    // function handleSuccess(stream) {
    //     const video = document.querySelector('video');
    //     const videoTracks = stream.getVideoTracks();
    //     window.stream = stream; // make variable available to browser console
    //     video.srcObject = stream;
    //
    //     video.addEventListener('loadedmetadata', function() {
    //         video.play();
    //     });
    // }

    // function handleSuccess(stream) {
    //     const video = document.querySelector('video');
    //     const videoTracks = stream.getVideoTracks();
    //     window.stream = stream; // make variable available to browser console
    //     video.srcObject = stream;
    //
    //     const recordedChunks = [];
    //     const mediaRecorder = new MediaRecorder(stream);
    //
    //     mediaRecorder.addEventListener('dataavailable', function(event) {
    //         if (event.data.size > 0) {
    //             recordedChunks.push(event.data);
    //         }
    //     });
    //
    //     mediaRecorder.addEventListener('stop', function() {
    //         const recordedBlob = new Blob(recordedChunks, { type: 'video/webm' });
    //         video.src = window.URL.createObjectURL(recordedBlob);
    //         video.play();
    //     });
    //
    //     mediaRecorder.start();
    //
    //     // Stop the media recorder after a certain duration (e.g., 5 seconds)
    //     setTimeout(function() {
    //         mediaRecorder.stop();
    //     }, 5000);
    // }

    function handleSuccess(stream) {
        const video = document.querySelector('video');
        const videoTracks = stream.getVideoTracks();
        window.stream = stream; // make variable available to browser console
        video.srcObject = stream;

        const canvas = document.querySelector('canvas');
        const canvasContext = canvas.getContext('2d');

        function captureFrame() {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvasContext.drawImage(video, 0, 0, canvas.width, canvas.height);
            requestAnimationFrame(captureFrame);
        }

        video.addEventListener('loadedmetadata', function () {
            video.play();
            captureFrame();
        });
    }


    function handleError(error) {
        if (error.name === 'OverconstrainedError') {
            const v = constraints.video;
            errorMsg(`The resolution ${v.width.exact}x${v.height.exact} px is not supported by your device.`);
        } else if (error.name === 'NotAllowedError') {
            // Check if Line Browser on Android
            if (navigator.userAgent.includes('Line') && navigator.userAgent.includes('Android')) {
                showCustomPermissionUI();
            } else {
                errorMsg('Permissions have not been granted to use your camera and ' +
                    'microphone, you need to allow the page access to your devices in ' +
                    'order for the demo to work.');
            }
        }
        errorMsg(`getUserMedia error: ${error.name}`, error);
    }

    // function showCustomPermissionUI() {
    //     // const permissionUI = document.createElement('div');
    //     // permissionUI.innerHTML = '<p>Tap the button below to grant access to the camera.</p><button id="grantPermissionButton">Grant Permission</button>';
    //     // document.body.appendChild(permissionUI);
    //
    //     const grantPermissionButton = document.getElementById('grantPermissionButton');
    //     grantPermissionButton.addEventListener('click', function() {
    //         init(navigator.mediaDevices.getUserMedia(constraints));
    //         // document.body.removeChild(permissionUI);
    //     });
    // }

    // function showCustomPermissionUI() {
    //     errorMsg('showCustomPermissionUI')
    //     init();
    //     const grantPermissionButton = document.getElementById('grantPermissionButton');
    //     errorMsg(grantPermissionButton)
    //     grantPermissionButton.addEventListener('click', function () {
    //         errorMsg('Request camera access')
    //         navigator.mediaDevices.getUserMedia({video: true}) // Request camera access
    //             .then(function (stream) {
    //                 // Access to camera is granted, do something with the stream
    //                 init(stream);
    //                 // document.body.removeChild(permissionUI);
    //             })
    //             .catch(function (error) {
    //                 // Access to camera is denied or an error occurred
    //                 console.log('Camera access denied or error:', error);
    //             });
    //     });
    // }

    function showCustomPermissionUI() {
        const permissionUI = document.createElement('div');
        permissionUI.innerHTML = '<p>Tap the button below to grant access to the camera.</p><button id="grantPermissionButton">Grant Permission</button>';
        document.body.appendChild(permissionUI);

        const grantPermissionButton = document.getElementById('grantPermissionButton');
        grantPermissionButton.addEventListener('click', function () {
            navigator.mediaDevices.getUserMedia({video: true}) // Request camera access
                .then(function (stream) {
                    // Access to camera is granted, do something with the stream
                    init(stream);
                    document.body.removeChild(permissionUI);
                })
                .catch(function (error) {
                    // Access to camera is denied or an error occurred
                    console.log('Camera access denied or error:', error);
                });
        });
    }

    function errorMsg(msg, error) {
        const errorElement = document.querySelector('#errorMsg');
        errorElement.innerHTML += `<p>${msg}</p>`;
        if (typeof error !== 'undefined') {
            console.error(error);
        }
    }

    async function init(e) {
        try {
            const stream = await navigator.mediaDevices.getUserMedia(constraints);
            handleSuccess(stream);
            e.target.disabled = true;
        } catch (e) {
            if (e.name === 'PermissionDeniedError' && navigator.userAgent.includes('Line') && navigator.userAgent.includes('Android')) {
                showCustomPermissionUI();
            } else {
                handleError(e);
            }
        }
    }

    document.querySelector('#showVideo').addEventListener('click', e => init(e));

    captureButton.addEventListener("click", function () {
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvasContext.drawImage(video, 0, 0, canvas.width, canvas.height);
        var imageDataURL = canvas.toDataURL("image/png");
        capturedImage.src = imageDataURL;
    });
</script>
</body>
</html>

<!--line 1-->
<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--    <title>Truy cập Webcam và Chụp ảnh trên Safari</title>-->
<!--    <meta charset="utf-8">-->
<!--    <meta name="description" content="WebRTC code samples">-->
<!--    <meta name="viewport" content="width=device-width, user-scalable=yes, initial-scale=1, maximum-scale=1">-->
<!--    <meta itemprop="description" content="Client-side WebRTC code samples">-->
<!--    <meta itemprop="image" content="../../../images/webrtc-icon-192x192.png">-->
<!--    <meta itemprop="name" content="WebRTC code samples">-->
<!--    <meta name="mobile-web-app-capable" content="yes">-->
<!--    <meta id="theme-color" name="theme-color" content="#ffffff">-->

<!--    <style>-->
<!--        #videoElement {-->
<!--            width: 100%;-->
<!--            height: auto;-->
<!--            object-fit: cover;-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--<video width="320" height="240" id="videoElement" autoplay muted playsinline></video>-->
<!--<button id="captureButton">Chụp ảnh</button>-->
<!--<button id="showVideo">Show video</button>-->
<!--<img id="capturedImage" alt="">-->
<!--<script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>-->
<!--<script src="https://cdn.jsdelivr.net/npm/getusermedia/dist/getUserMedia.js"></script>-->

<!--<script>-->
<!--    var video = document.getElementById("videoElement");-->
<!--    var captureButton = document.getElementById("captureButton");-->
<!--    var capturedImage = document.getElementById("capturedImage");-->
<!--    var canvas = document.createElement("canvas");-->
<!--    var canvasContext = canvas.getContext("2d");-->

<!--    const constraints = {-->
<!--        audio: false,-->
<!--        video: true-->
<!--    };-->

<!--    function handleSuccess(stream) {-->
<!--        const video = document.querySelector('video');-->
<!--        const videoTracks = stream.getVideoTracks();-->
<!--        window.stream = stream; // make variable available to browser console-->
<!--        video.srcObject = stream;-->
<!--        const recordedChunks = [];-->
<!--        const mediaRecorder = new MediaRecorder(stream);-->
<!--        mediaRecorder.addEventListener('dataavailable', function(event) {-->
<!--            if (event.data.size > 0) {-->
<!--                recordedChunks.push(event.data);-->
<!--            }-->
<!--        });-->
<!--        mediaRecorder.addEventListener('stop', function() {-->
<!--            const recordedBlob = new Blob(recordedChunks, { type: 'video/webm' });-->
<!--            video.src = window.URL.createObjectURL(recordedBlob);-->
<!--            video.play();-->
<!--        });-->
<!--        mediaRecorder.start();-->
<!--        // Stop the media recorder after a certain duration (e.g., 5 seconds)-->
<!--        setTimeout(function() {-->
<!--            mediaRecorder.stop();-->
<!--        }, 5000);-->
<!--    }-->

<!--    function handleError(error) {-->
<!--        if (error.name === 'OverconstrainedError') {-->
<!--            const v = constraints.video;-->
<!--            errorMsg(`The resolution ${v.width.exact}x${v.height.exact} px is not supported by your device.`);-->
<!--        } else if (error.name === 'NotAllowedError') {-->
<!--            errorMsg('Permissions have not been granted to use your camera and ' +-->
<!--                'microphone, you need to allow the page access to your devices in ' +-->
<!--                'order for the demo to work.');-->
<!--        } else {-->
<!--            errorMsg(`getUserMedia error: ${error.name}`, error);-->
<!--        }-->
<!--    }-->

<!--    function errorMsg(msg, error) {-->
<!--        const errorElement = document.querySelector('#errorMsg');-->
<!--        errorElement.innerHTML += `<p>${msg}</p>`;-->
<!--        if (typeof error !== 'undefined') {-->
<!--            console.error(error);-->
<!--        }-->
<!--    }-->

<!--    async function init(e) {-->
<!--        try {-->
<!--            const stream = await navigator.mediaDevices.getUserMedia(constraints);-->
<!--            handleSuccess(stream);-->
<!--            e.target.disabled = true;-->
<!--        } catch (e) {-->
<!--            if (e.name === 'PermissionDeniedError' && navigator.userAgent.includes('Line') && navigator.userAgent.includes('Android')) {-->
<!--                showCustomPermissionUI();-->
<!--            } else {-->
<!--                handleError(e);-->
<!--            }-->
<!--        }-->
<!--    }-->

<!--    function showCustomPermissionUI() {-->
<!--        const permissionUI = document.createElement('div');-->
<!--        permissionUI.innerHTML = '<p>Tap the button below to grant access to the camera.</p><button id="grantPermissionButton">Grant Permission</button>';-->
<!--        document.body.appendChild(permissionUI);-->

<!--        const grantPermissionButton = document.getElementById('grantPermissionButton');-->
<!--        grantPermissionButton.addEventListener('click', function() {-->
<!--            init(navigator.mediaDevices.getUserMedia(constraints));-->
<!--            document.body.removeChild(permissionUI);-->
<!--        });-->
<!--    }-->

<!--    document.querySelector('#showVideo').addEventListener('click', e => init(e));-->

<!--    captureButton.addEventListener("click", function() {-->
<!--        canvas.width = video.videoWidth;-->
<!--        canvas.height = video.videoHeight;-->
<!--        canvasContext.drawImage(video, 0, 0, canvas.width, canvas.height);-->
<!--        var imageDataURL = canvas.toDataURL("image/png");-->
<!--        capturedImage.src = imageDataURL;-->
<!--    });-->
<!--</script>-->
<!--</body>-->
<!--</html>-->